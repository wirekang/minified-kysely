function e(e){return void 0===e||void 0===e}function t(e){return"string"==typeof e}function r(e){return"number"==typeof e}function o(e){return"boolean"==typeof e}function n(e){return null===e}function i(e){return e instanceof Date}function s(e){return"bigint"==typeof e}function a(e){return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)}function d(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function h(e){if(!u(e)||"[object Object]"!==function(e){if(null==e)return void 0===e?"[object Undefined]":"[object Null]";return y.call(e)}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function c(e){return e[e.length-1]}function p(e){return Object.freeze(e)}function l(e){return f(e)?e:[e]}function f(e){return Array.isArray(e)}function m(e){return e}function N(e,t){return f(e)&&f(t)?function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!N(e[r],t[r]))return!1;return!0}(e,t):u(e)&&u(t)?function(e,t){if(a(e)&&a(t))return o=e,n=t,0===Buffer.compare(o,n);if(i(e)&&i(t))return r=t,e.getTime()===r.getTime();var r;var o,n;return function(e,t){const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(const o of r)if(!N(e[o],t[o]))return!1;return!0}(e,t)}(e,t):e===t}const y=Object.prototype.toString;const w=p({is:e=>"IdentifierNode"===e.kind,create:e=>p({kind:"IdentifierNode",name:e})}),g=p({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>p({kind:"SchemableIdentifierNode",identifier:w.create(e)}),createWithSchema:(e,t)=>p({kind:"SchemableIdentifierNode",schema:w.create(e),identifier:w.create(t)})}),W=p({is:e=>"AliasNode"===e.kind,create:(e,t)=>p({kind:"AliasNode",node:e,alias:t})}),b=p({is:e=>"TableNode"===e.kind,create:e=>p({kind:"TableNode",table:g.create(e)}),createWithSchema:(e,t)=>p({kind:"TableNode",table:g.createWithSchema(e,t)})});function O(e){return u(e)&&d(e.toOperationNode)}function q(e){return u(e)&&"expressionType"in e&&O(e)}function k(e){return u(e)&&"expression"in e&&t(e.alias)&&O(e)}const x=p({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>p({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>p({kind:"SelectModifierNode",rawModifier:e})}),C=p({is:e=>"AndNode"===e.kind,create:(e,t)=>p({kind:"AndNode",left:e,right:t})}),I=p({is:e=>"OrNode"===e.kind,create:(e,t)=>p({kind:"OrNode",left:e,right:t})}),S=p({is:e=>"OnNode"===e.kind,create:e=>p({kind:"OnNode",on:e}),cloneWithOperation:(e,t,r)=>p({...e,on:"And"===t?C.create(e.on,r):I.create(e.on,r)})}),v=p({is:e=>"JoinNode"===e.kind,create:(e,t)=>p({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,r)=>p({kind:"JoinNode",joinType:e,table:t,on:S.create(r)}),cloneWithOn:(e,t)=>p({...e,on:e.on?S.cloneWithOperation(e.on,"And",t):S.create(t)})}),T=p({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,r)=>p({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})}),B=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],A=["+","-","*","/","%","^","&","|","#","<<",">>"],R=["->","->>"],L=[...B,...A,"&&","||"],E=["exists","not exists"],F=["not","-",...E],D=[...L,...R,...F,"between","between symmetric"],M=p({is:e=>"OperatorNode"===e.kind,create:e=>p({kind:"OperatorNode",operator:e})});function j(e){return t(e)&&D.includes(e)}function P(e){return t(e)&&L.includes(e)}function J(e){return t(e)&&B.includes(e)}function Q(e){return t(e)&&A.includes(e)}function $(e){return t(e)&&R.includes(e)}const U=p({is:e=>"ColumnNode"===e.kind,create:e=>p({kind:"ColumnNode",column:w.create(e)})}),V=p({is:e=>"SelectAllNode"===e.kind,create:()=>p({kind:"SelectAllNode"})}),z=p({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>p({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>p({kind:"ReferenceNode",table:e,column:V.create()})});class G{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return de(this.#e)}}function K(e){return u(e)&&O(e)&&t(e.dynamicReference)}const H=p({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>p({kind:"OrderByItemNode",orderBy:e,direction:t}),cloneWith:(e,t)=>p({...e,...t})}),_=p({is:e=>"RawNode"===e.kind,create:(e,t)=>p({kind:"RawNode",sqlFragments:p(e),parameters:p(t)}),createWithSql:e=>_.create([e],[]),createWithChild:e=>_.create(["",""],[e]),createWithChildren:e=>_.create(new Array(e.length+1).fill(""),e)}),X=p({is:e=>"CollateNode"===e.kind,create:e=>p({kind:"CollateNode",collation:w.create(e)})});class Y{#t;constructor(e){this.#t=p(e)}desc(){return new Y({node:H.cloneWith(this.#t.node,{direction:_.createWithSql("desc")})})}asc(){return new Y({node:H.cloneWith(this.#t.node,{direction:_.createWithSql("asc")})})}nullsLast(){return new Y({node:H.cloneWith(this.#t.node,{nulls:"last"})})}nullsFirst(){return new Y({node:H.cloneWith(this.#t.node,{nulls:"first"})})}collate(e){return new Y({node:H.cloneWith(this.#t.node,{collation:X.create(e)})})}toOperationNode(){return this.#t.node}}const Z=new Set;function ee(e){Z.has(e)||(Z.add(e),console.log(e))}function te(e){return"asc"===e||"desc"===e}function re(e){if(2===e.length)return[oe(e[0],e[1])];if(1===e.length){const[t]=e;return Array.isArray(t)?(ee("orderBy(array) is deprecated, use multiple orderBy calls instead."),t.map((e=>oe(e)))):[oe(t)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function oe(e,t){const r=function(e){if(Vr(e))return $r(e);if(K(e))return e.toOperationNode();const[t,r]=e.split(" ");if(r)return ee("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),ne(ce(t),r);return ce(e)}(e);if(H.is(r)){if(t)throw new Error("Cannot specify direction twice!");return r}return ne(r,t)}function ne(e,t){if("string"==typeof t){if(!te(t))throw new Error(`Invalid order by direction: ${t}`);return H.create(e,_.createWithSql(t))}if(q(t))return ee("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),H.create(e,t.toOperationNode());const r=H.create(e);return t?t(new Y({node:r})).toOperationNode():r}const ie=p({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>p({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>p({...e,traversal:t})}),se=p({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>p({kind:"JSONOperatorChainNode",operator:e,values:p([])}),cloneWithValue:(e,t)=>p({...e,values:p([...e.values,t])})}),ae=p({is:e=>"JSONPathNode"===e.kind,create:e=>p({kind:"JSONPathNode",inOperator:e,pathLegs:p([])}),cloneWithLeg:(e,t)=>p({...e,pathLegs:p([...e.pathLegs,t])})});function de(e){return t(e)?ce(e):e.toOperationNode()}function ue(e){return f(e)?e.map((e=>he(e))):[he(e)]}function he(e){return Vr(e)?$r(e):de(e)}function ce(e){if(!e.includes("."))return z.create(U.create(e));const t=e.split(".").map(fe);if(3===t.length)return function(e){const[t,r,o]=e;return z.create(U.create(o),b.createWithSchema(t,r))}(t);if(2===t.length)return function(e){const[t,r]=e;return z.create(U.create(r),b.create(t))}(t);throw new Error(`invalid column reference ${e}`)}function pe(e){return U.create(e)}function le(e){if(e.includes(" ")){const[t,r]=e.split(" ").map(fe);if(!te(r))throw new Error(`invalid order direction "${r}" next to "${t}"`);return re([t,r])[0]}return pe(e)}function fe(e){return e.trim()}const me=p({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>p({kind:"PrimitiveValueListNode",values:p([...e])})}),Ne=p({is:e=>"ValueListNode"===e.kind,create:e=>p({kind:"ValueListNode",values:p(e)})}),ye=p({is:e=>"ValueNode"===e.kind,create:e=>p({kind:"ValueNode",value:e}),createImmediate:e=>p({kind:"ValueNode",value:e,immediate:!0})});function we(e){return f(e)?function(e){if(e.some(Vr))return Ne.create(e.map((e=>ge(e))));return me.create(e)}(e):ge(e)}function ge(e){return Vr(e)?$r(e):ye.create(e)}function We(e){return r(e)||o(e)||n(e)}function be(e){if(!We(e))throw new Error(`unsafe immediate value ${JSON.stringify(e)}`);return ye.createImmediate(e)}const Oe=p({is:e=>"ParensNode"===e.kind,create:e=>p({kind:"ParensNode",node:e})});function qe(e){if(3===e.length)return ke(e[0],e[1],e[2]);if(1===e.length)return ge(e[0]);throw new Error(`invalid arguments: ${JSON.stringify(e)}`)}function ke(e,t,r){return function(e){return"is"===e||"is not"===e}(t)&&Se(r)?T.create(he(e),ve(t),ye.createImmediate(r)):T.create(he(e),ve(t),we(r))}function xe(e,t,r){return T.create(he(e),ve(t),he(r))}function Ce(t,r){return Ie(Object.entries(t).filter((([,t])=>!e(t))).map((([e,t])=>ke(e,Se(t)?"is":"=",t))),r)}function Ie(e,t,r=!0){const o="and"===t?C.create:I.create;if(0===e.length)return T.create(ye.createImmediate(1),M.create("="),ye.createImmediate("and"===t?1:0));let n=Te(e[0]);for(let t=1;t<e.length;++t)n=o(n,Te(e[t]));return e.length>1&&r?Oe.create(n):n}function Se(e){return n(e)||o(e)}function ve(e){if(t(e)&&D.includes(e))return M.create(e);if(O(e))return e.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(e)}`)}function Te(e){return O(e)?e.toOperationNode():e}const Be=p({is:e=>"OrderByNode"===e.kind,create:e=>p({kind:"OrderByNode",items:p([...e])}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),Ae=p({is:e=>"PartitionByNode"===e.kind,create:e=>p({kind:"PartitionByNode",items:p(e)}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),Re=p({is:e=>"OverNode"===e.kind,create:()=>p({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>p({...e,orderBy:e.orderBy?Be.cloneWithItems(e.orderBy,t):Be.create(t)}),cloneWithPartitionByItems:(e,t)=>p({...e,partitionBy:e.partitionBy?Ae.cloneWithItems(e.partitionBy,t):Ae.create(t)})}),Le=p({is:e=>"FromNode"===e.kind,create:e=>p({kind:"FromNode",froms:p(e)}),cloneWithFroms:(e,t)=>p({...e,froms:p([...e.froms,...t])})}),Ee=p({is:e=>"GroupByNode"===e.kind,create:e=>p({kind:"GroupByNode",items:p(e)}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),Fe=p({is:e=>"HavingNode"===e.kind,create:e=>p({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,r)=>p({...e,having:"And"===t?C.create(e.having,r):I.create(e.having,r)})}),De=p({is:e=>"InsertQueryNode"===e.kind,create:(e,t,r)=>p({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r}),createWithoutInto:()=>p({kind:"InsertQueryNode"}),cloneWith:(e,t)=>p({...e,...t})}),Me=p({is:e=>"ListNode"===e.kind,create:e=>p({kind:"ListNode",items:p(e)})}),je=p({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>p({kind:"UpdateQueryNode",table:1===e.length?e[0]:Me.create(e),...t&&{with:t}}),createWithoutTable:()=>p({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>p({...e,from:e.from?Le.cloneWithFroms(e.from,t):Le.create(t)}),cloneWithUpdates:(e,t)=>p({...e,updates:e.updates?p([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>p({...e,limit:t})}),Pe=p({is:e=>"UsingNode"===e.kind,create:e=>p({kind:"UsingNode",tables:p(e)}),cloneWithTables:(e,t)=>p({...e,tables:p([...e.tables,...t])})}),Je=p({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>p({kind:"DeleteQueryNode",from:Le.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>Ke.cloneWithOrderByItems(e,t),cloneWithoutOrderBy:e=>Ke.cloneWithoutOrderBy(e),cloneWithLimit:(e,t)=>p({...e,limit:t}),cloneWithoutLimit:e=>p({...e,limit:void 0}),cloneWithUsing:(e,t)=>p({...e,using:void 0!==e.using?Pe.cloneWithTables(e.using,t):Pe.create(t)})}),Qe=p({is:e=>"WhereNode"===e.kind,create:e=>p({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,r)=>p({...e,where:"And"===t?C.create(e.where,r):I.create(e.where,r)})}),$e=p({is:e=>"ReturningNode"===e.kind,create:e=>p({kind:"ReturningNode",selections:p(e)}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)})}),Ue=p({is:e=>"ExplainNode"===e.kind,create:(e,t)=>p({kind:"ExplainNode",format:e,options:t})}),Ve=p({is:e=>"WhenNode"===e.kind,create:e=>p({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>p({...e,result:t})}),ze=p({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>p({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>p({...e,using:t}),cloneWithWhen:(e,t)=>p({...e,whens:e.whens?p([...e.whens,t]):p([t])}),cloneWithThen:(e,t)=>p({...e,whens:e.whens?p([...e.whens.slice(0,-1),Ve.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}),Ge=p({is:e=>"OutputNode"===e.kind,create:e=>p({kind:"OutputNode",selections:p(e)}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)})}),Ke=p({is:e=>He.is(e)||De.is(e)||je.is(e)||Je.is(e)||ze.is(e),cloneWithEndModifier:(e,t)=>p({...e,endModifiers:e.endModifiers?p([...e.endModifiers,t]):p([t])}),cloneWithWhere:(e,t)=>p({...e,where:e.where?Qe.cloneWithOperation(e.where,"And",t):Qe.create(t)}),cloneWithJoin:(e,t)=>p({...e,joins:e.joins?p([...e.joins,t]):p([t])}),cloneWithReturning:(e,t)=>p({...e,returning:e.returning?$e.cloneWithSelections(e.returning,t):$e.create(t)}),cloneWithoutReturning:e=>p({...e,returning:void 0}),cloneWithoutWhere:e=>p({...e,where:void 0}),cloneWithExplain:(e,t,r)=>p({...e,explain:Ue.create(t,r?.toOperationNode())}),cloneWithTop:(e,t)=>p({...e,top:t}),cloneWithOutput:(e,t)=>p({...e,output:e.output?Ge.cloneWithSelections(e.output,t):Ge.create(t)}),cloneWithOrderByItems:(e,t)=>p({...e,orderBy:e.orderBy?Be.cloneWithItems(e.orderBy,t):Be.create(t)}),cloneWithoutOrderBy:e=>p({...e,orderBy:void 0})}),He=p({is:e=>"SelectQueryNode"===e.kind,create:e=>p({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,t)=>p({kind:"SelectQueryNode",from:Le.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)}),cloneWithDistinctOn:(e,t)=>p({...e,distinctOn:e.distinctOn?p([...e.distinctOn,...t]):p(t)}),cloneWithFrontModifier:(e,t)=>p({...e,frontModifiers:e.frontModifiers?p([...e.frontModifiers,t]):p([t])}),cloneWithOrderByItems:(e,t)=>Ke.cloneWithOrderByItems(e,t),cloneWithGroupByItems:(e,t)=>p({...e,groupBy:e.groupBy?Ee.cloneWithItems(e.groupBy,t):Ee.create(t)}),cloneWithLimit:(e,t)=>p({...e,limit:t}),cloneWithOffset:(e,t)=>p({...e,offset:t}),cloneWithFetch:(e,t)=>p({...e,fetch:t}),cloneWithHaving:(e,t)=>p({...e,having:e.having?Fe.cloneWithOperation(e.having,"And",t):Fe.create(t)}),cloneWithSetOperations:(e,t)=>p({...e,setOperations:e.setOperations?p([...e.setOperations,...t]):p([...t])}),cloneWithoutSelections:e=>p({...e,selections:[]}),cloneWithoutLimit:e=>p({...e,limit:void 0}),cloneWithoutOffset:e=>p({...e,offset:void 0}),cloneWithoutOrderBy:e=>Ke.cloneWithoutOrderBy(e),cloneWithoutGroupBy:e=>p({...e,groupBy:void 0})});class _e{#t;constructor(e){this.#t=p(e)}on(...e){return new _e({...this.#t,joinNode:v.cloneWithOn(this.#t.joinNode,qe(e))})}onRef(e,t,r){return new _e({...this.#t,joinNode:v.cloneWithOn(this.#t.joinNode,xe(e,t,r))})}onTrue(){return new _e({...this.#t,joinNode:v.cloneWithOn(this.#t.joinNode,_.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#t.joinNode}}const Xe=p({is:e=>"PartitionByItemNode"===e.kind,create:e=>p({kind:"PartitionByItemNode",partitionBy:e})});function Ye(e){return ue(e).map(Xe.create)}class Ze{#t;constructor(e){this.#t=p(e)}orderBy(...e){return new Ze({overNode:Re.cloneWithOrderByItems(this.#t.overNode,re(e))})}clearOrderBy(){return new Ze({overNode:Ke.cloneWithoutOrderBy(this.#t.overNode)})}partitionBy(e){return new Ze({overNode:Re.cloneWithPartitionByItems(this.#t.overNode,Ye(e))})}$call(e){return e(this)}toOperationNode(){return this.#t.overNode}}const et=p({is:e=>"SelectionNode"===e.kind,create:e=>p({kind:"SelectionNode",selection:e}),createSelectAll:()=>p({kind:"SelectionNode",selection:V.create()}),createSelectAllFromTable:e=>p({kind:"SelectionNode",selection:z.createSelectAll(e)})});function tt(e){return d(e)?tt(e(Qr())):f(e)?e.map((e=>rt(e))):[rt(e)]}function rt(e){return t(e)?et.create(function(e){const t=" as ";if(e.includes(t)){const[r,o]=e.split(t).map(fe);return W.create(ce(r),w.create(o))}return ce(e)}(e)):K(e)?et.create(e.toOperationNode()):et.create(Ur(e))}function ot(e){return e?Array.isArray(e)?e.map(nt):[nt(e)]:[et.createSelectAll()]}function nt(e){if(t(e))return et.createSelectAllFromTable(Yr(e));throw new Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}const it=p({is:e=>"ValuesNode"===e.kind,create:e=>p({kind:"ValuesNode",values:p(e)})}),st=p({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>p({kind:"DefaultInsertValueNode"})});function at(t){const r=d(t)?t(Qr()):t;return function(t){const r=function(e){const t=new Map;for(const r of e){const e=Object.keys(r);for(const o of e)t.has(o)||void 0===r[o]||t.set(o,t.size)}return t}(t);return[p([...r.keys()].map(U.create)),it.create(t.map((t=>function(t,r){const o=Object.keys(t),n=Array.from({length:r.size});let i=!1,s=o.length;for(const a of o){const o=r.get(a);if(e(o)){s--;continue}const d=t[a];(e(d)||Vr(d))&&(i=!0),n[o]=d}const a=s<r.size;if(a||i){const t=st.create();return Ne.create(n.map((r=>e(r)?t:ge(r))))}return me.create(n)}(t,r))))]}(f(r)?r:p([r]))}const dt=p({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>p({kind:"ColumnUpdateNode",column:e,value:t})});function ut(...e){return 2===e.length?[dt.create(he(e[0]),ge(e[1]))]:ht(e[0])}function ht(e){const t=d(e)?e(Qr()):e;return Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>dt.create(U.create(e),ge(t))))}const ct=p({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>p({kind:"OnDuplicateKeyNode",updates:e})});class pt{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}class lt extends Error{node;constructor(e){super("no result"),this.node=e}}function ft(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}const mt=p({is:e=>"OnConflictNode"===e.kind,create:()=>p({kind:"OnConflictNode"}),cloneWith:(e,t)=>p({...e,...t}),cloneWithIndexWhere:(e,t)=>p({...e,indexWhere:e.indexWhere?Qe.cloneWithOperation(e.indexWhere,"And",t):Qe.create(t)}),cloneWithIndexOrWhere:(e,t)=>p({...e,indexWhere:e.indexWhere?Qe.cloneWithOperation(e.indexWhere,"Or",t):Qe.create(t)}),cloneWithUpdateWhere:(e,t)=>p({...e,updateWhere:e.updateWhere?Qe.cloneWithOperation(e.updateWhere,"And",t):Qe.create(t)}),cloneWithUpdateOrWhere:(e,t)=>p({...e,updateWhere:e.updateWhere?Qe.cloneWithOperation(e.updateWhere,"Or",t):Qe.create(t)}),cloneWithoutIndexWhere:e=>p({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>p({...e,updateWhere:void 0})});class Nt{#t;constructor(e){this.#t=p(e)}column(e){const t=U.create(e);return new Nt({...this.#t,onConflictNode:mt.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?p([...this.#t.onConflictNode.columns,t]):p([t])})})}columns(e){const t=e.map(U.create);return new Nt({...this.#t,onConflictNode:mt.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?p([...this.#t.onConflictNode.columns,...t]):p(t)})})}constraint(e){return new Nt({...this.#t,onConflictNode:mt.cloneWith(this.#t.onConflictNode,{constraint:w.create(e)})})}expression(e){return new Nt({...this.#t,onConflictNode:mt.cloneWith(this.#t.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new Nt({...this.#t,onConflictNode:mt.cloneWithIndexWhere(this.#t.onConflictNode,qe(e))})}whereRef(e,t,r){return new Nt({...this.#t,onConflictNode:mt.cloneWithIndexWhere(this.#t.onConflictNode,xe(e,t,r))})}clearWhere(){return new Nt({...this.#t,onConflictNode:mt.cloneWithoutIndexWhere(this.#t.onConflictNode)})}doNothing(){return new yt({...this.#t,onConflictNode:mt.cloneWith(this.#t.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new wt({...this.#t,onConflictNode:mt.cloneWith(this.#t.onConflictNode,{updates:ht(e)})})}$call(e){return e(this)}}class yt{#t;constructor(e){this.#t=p(e)}toOperationNode(){return this.#t.onConflictNode}}class wt{#t;constructor(e){this.#t=p(e)}where(...e){return new wt({...this.#t,onConflictNode:mt.cloneWithUpdateWhere(this.#t.onConflictNode,qe(e))})}whereRef(e,t,r){return new wt({...this.#t,onConflictNode:mt.cloneWithUpdateWhere(this.#t.onConflictNode,xe(e,t,r))})}clearWhere(){return new wt({...this.#t,onConflictNode:mt.cloneWithoutUpdateWhere(this.#t.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#t.onConflictNode}}const gt=p({is:e=>"TopNode"===e.kind,create:(e,t)=>p({kind:"TopNode",expression:e,modifiers:t})});function Wt(t,o){if(!r(t)&&!s(t))throw new Error(`Invalid top expression: ${t}`);if(!e(o)&&!function(e){return"percent"===e||"with ties"===e||"percent with ties"===e}(o))throw new Error(`Invalid top modifiers: ${o}`);return gt.create(t,o)}const bt=p({is:e=>"OrActionNode"===e.kind,create:e=>p({kind:"OrActionNode",action:e})});class Ot{#t;constructor(e){this.#t=p(e)}values(e){const[t,r]=at(e);return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{columns:t,values:r})})}columns(e){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{columns:p(e.map(U.create))})})}expression(e){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{values:$r(e)})})}defaultValues(){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{defaultValues:!0})})}modifyEnd(e){return new Ot({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}ignore(){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{orAction:bt.create("ignore")})})}orIgnore(){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{orAction:bt.create("ignore")})})}orAbort(){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{orAction:bt.create("abort")})})}orFail(){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{orAction:bt.create("fail")})})}orReplace(){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{orAction:bt.create("replace")})})}orRollback(){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{orAction:bt.create("rollback")})})}top(e,t){return new Ot({...this.#t,queryNode:Ke.cloneWithTop(this.#t.queryNode,Wt(e,t))})}onConflict(e){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{onConflict:e(new Nt({onConflictNode:mt.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Ot({...this.#t,queryNode:De.cloneWith(this.#t.queryNode,{onDuplicateKey:ct.create(ht(e))})})}returning(e){return new Ot({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,tt(e))})}returningAll(){return new Ot({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,ot())})}output(e){return new Ot({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,tt(e))})}outputAll(e){return new Ot({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,ot(e))})}clearReturning(){return new Ot({...this.#t,queryNode:Ke.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Ot({...this.#t})}$castTo(){return new Ot(this.#t)}$narrowType(){return new Ot(this.#t)}$assertType(){return new Ot(this.#t)}withPlugin(e){return new Ot({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e),{adapter:r}=this.#t.executor,o=e.query;return o.returning&&r.supportsReturning||o.output&&r.supportsOutput?t.rows:[new pt(t.insertId,t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=lt){const t=await this.executeTakeFirst();if(void 0===t){throw ft(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e);for await(const e of r)yield*e.rows}async explain(e,t){const r=new Ot({...this.#t,queryNode:Ke.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class qt{numDeletedRows;constructor(e){this.numDeletedRows=e}}const kt=p({is:e=>"LimitNode"===e.kind,create:e=>p({kind:"LimitNode",limit:e})});class xt{#t;constructor(e){this.#t=p(e)}where(...e){return new xt({...this.#t,queryNode:Ke.cloneWithWhere(this.#t.queryNode,qe(e))})}whereRef(e,t,r){return new xt({...this.#t,queryNode:Ke.cloneWithWhere(this.#t.queryNode,xe(e,t,r))})}clearWhere(){return new xt({...this.#t,queryNode:Ke.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new xt({...this.#t,queryNode:Ke.cloneWithTop(this.#t.queryNode,Wt(e,t))})}using(e){return new xt({...this.#t,queryNode:Je.cloneWithUsing(this.#t.queryNode,Hr(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}#r(e,t){return new xt({...this.#t,queryNode:Ke.cloneWithJoin(this.#t.queryNode,nr(e,t))})}returning(e){return new xt({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,tt(e))})}returningAll(e){return new xt({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,ot(e))})}output(e){return new xt({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,tt(e))})}outputAll(e){return new xt({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,ot(e))})}clearReturning(){return new xt({...this.#t,queryNode:Ke.cloneWithoutReturning(this.#t.queryNode)})}clearLimit(){return new xt({...this.#t,queryNode:Je.cloneWithoutLimit(this.#t.queryNode)})}orderBy(...e){return new xt({...this.#t,queryNode:Ke.cloneWithOrderByItems(this.#t.queryNode,re(e))})}clearOrderBy(){return new xt({...this.#t,queryNode:Ke.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new xt({...this.#t,queryNode:Je.cloneWithLimit(this.#t.queryNode,kt.create(ge(e)))})}modifyEnd(e){return new xt({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,t){return e?t(this):new xt({...this.#t})}$castTo(){return new xt(this.#t)}$narrowType(){return new xt(this.#t)}$assertType(){return new xt(this.#t)}withPlugin(e){return new xt({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e),{adapter:r}=this.#t.executor,o=e.query;return o.returning&&r.supportsReturning||o.output&&r.supportsOutput?t.rows:[new qt(t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=lt){const t=await this.executeTakeFirst();if(void 0===t){throw ft(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e);for await(const e of r)yield*e.rows}async explain(e,t){const r=new xt({...this.#t,queryNode:Ke.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}class Ct{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}class It{#t;constructor(e){this.#t=p(e)}where(...e){return new It({...this.#t,queryNode:Ke.cloneWithWhere(this.#t.queryNode,qe(e))})}whereRef(e,t,r){return new It({...this.#t,queryNode:Ke.cloneWithWhere(this.#t.queryNode,xe(e,t,r))})}clearWhere(){return new It({...this.#t,queryNode:Ke.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new It({...this.#t,queryNode:Ke.cloneWithTop(this.#t.queryNode,Wt(e,t))})}from(e){return new It({...this.#t,queryNode:je.cloneWithFromItems(this.#t.queryNode,Hr(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}#r(e,t){return new It({...this.#t,queryNode:Ke.cloneWithJoin(this.#t.queryNode,nr(e,t))})}orderBy(...e){return new It({...this.#t,queryNode:Ke.cloneWithOrderByItems(this.#t.queryNode,re(e))})}clearOrderBy(){return new It({...this.#t,queryNode:Ke.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new It({...this.#t,queryNode:je.cloneWithLimit(this.#t.queryNode,kt.create(ge(e)))})}set(...e){return new It({...this.#t,queryNode:je.cloneWithUpdates(this.#t.queryNode,ut(...e))})}returning(e){return new It({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,tt(e))})}returningAll(e){return new It({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,ot(e))})}output(e){return new It({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,tt(e))})}outputAll(e){return new It({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,ot(e))})}modifyEnd(e){return new It({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}clearReturning(){return new It({...this.#t,queryNode:Ke.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new It({...this.#t})}$castTo(){return new It(this.#t)}$narrowType(){return new It(this.#t)}$assertType(){return new It(this.#t)}withPlugin(e){return new It({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e),{adapter:r}=this.#t.executor,o=e.query;return o.returning&&r.supportsReturning||o.output&&r.supportsOutput?t.rows:[new Ct(t.numAffectedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=lt){const t=await this.executeTakeFirst();if(void 0===t){throw ft(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e);for await(const e of r)yield*e.rows}async explain(e,t){const r=new It({...this.#t,queryNode:Ke.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}const St=p({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>p({kind:"CommonTableExpressionNameNode",table:b.create(e),columns:t?p(t.map(U.create)):void 0})}),vt=p({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>p({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>p({...e,...t})});class Tt{#t;constructor(e){this.#t=p(e)}materialized(){return new Tt({...this.#t,node:vt.cloneWith(this.#t.node,{materialized:!0})})}notMaterialized(){return new Tt({...this.#t,node:vt.cloneWith(this.#t.node,{materialized:!1})})}toOperationNode(){return this.#t.node}}function Bt(e,t){const r=t(new or({executor:Xt})).toOperationNode();return d(e)?e(function(e){return t=>new Tt({node:vt.create(At(t),e)})}(r)).toOperationNode():vt.create(At(e),r)}function At(e){if(e.includes("(")){const t=e.split(/[\(\)]/),r=t[0],o=t[1].split(",").map((e=>e.trim()));return St.create(r,o)}return St.create(e)}const Rt=p({is:e=>"WithNode"===e.kind,create:(e,t)=>p({kind:"WithNode",expressions:p([e]),...t}),cloneWithExpression:(e,t)=>p({...e,expressions:p([...e.expressions,t])})}),Lt=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Et(e){let t="";for(let r=0;r<e;++r)t+=Lt[~~(Math.random()*Lt.length)];return t}function Ft(){return new Dt}class Dt{#o;get queryId(){return void 0===this.#o&&(this.#o=Et(8)),this.#o}}class Mt{nodeStack=[];#n=p({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(e,t){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e,t);return this.nodeStack.pop(),p(r)}transformNodeImpl(e,t){return this.#n[e.kind](e,t)}transformNodeList(e,t){return e?p(e.map((e=>this.transformNode(e,t)))):e}transformSelectQuery(e,t){return{kind:"SelectQueryNode",from:this.transformNode(e.from,t),selections:this.transformNodeList(e.selections,t),distinctOn:this.transformNodeList(e.distinctOn,t),joins:this.transformNodeList(e.joins,t),groupBy:this.transformNode(e.groupBy,t),orderBy:this.transformNode(e.orderBy,t),where:this.transformNode(e.where,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),limit:this.transformNode(e.limit,t),offset:this.transformNode(e.offset,t),with:this.transformNode(e.with,t),having:this.transformNode(e.having,t),explain:this.transformNode(e.explain,t),setOperations:this.transformNodeList(e.setOperations,t),fetch:this.transformNode(e.fetch,t),top:this.transformNode(e.top,t)}}transformSelection(e,t){return{kind:"SelectionNode",selection:this.transformNode(e.selection,t)}}transformColumn(e,t){return{kind:"ColumnNode",column:this.transformNode(e.column,t)}}transformAlias(e,t){return{kind:"AliasNode",node:this.transformNode(e.node,t),alias:this.transformNode(e.alias,t)}}transformTable(e,t){return{kind:"TableNode",table:this.transformNode(e.table,t)}}transformFrom(e,t){return{kind:"FromNode",froms:this.transformNodeList(e.froms,t)}}transformReference(e,t){return{kind:"ReferenceNode",column:this.transformNode(e.column,t),table:this.transformNode(e.table,t)}}transformAnd(e,t){return{kind:"AndNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformOr(e,t){return{kind:"OrNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)}}transformValueList(e,t){return{kind:"ValueListNode",values:this.transformNodeList(e.values,t)}}transformParens(e,t){return{kind:"ParensNode",node:this.transformNode(e.node,t)}}transformJoin(e,t){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table,t),on:this.transformNode(e.on,t)}}transformRaw(e,t){return{kind:"RawNode",sqlFragments:p([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters,t)}}transformWhere(e,t){return{kind:"WhereNode",where:this.transformNode(e.where,t)}}transformInsertQuery(e,t){return{kind:"InsertQueryNode",into:this.transformNode(e.into,t),columns:this.transformNodeList(e.columns,t),values:this.transformNode(e.values,t),returning:this.transformNode(e.returning,t),onConflict:this.transformNode(e.onConflict,t),onDuplicateKey:this.transformNode(e.onDuplicateKey,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),ignore:e.ignore,orAction:this.transformNode(e.orAction,t),replace:e.replace,explain:this.transformNode(e.explain,t),defaultValues:e.defaultValues,top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformValues(e,t){return{kind:"ValuesNode",values:this.transformNodeList(e.values,t)}}transformDeleteQuery(e,t){return{kind:"DeleteQueryNode",from:this.transformNode(e.from,t),using:this.transformNode(e.using,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),orderBy:this.transformNode(e.orderBy,t),limit:this.transformNode(e.limit,t),explain:this.transformNode(e.explain,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)}}transformReturning(e,t){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections,t)}}transformCreateTable(e,t){return{kind:"CreateTableNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),constraints:this.transformNodeList(e.constraints,t),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),selectQuery:this.transformNode(e.selectQuery,t)}}transformColumnDefinition(e,t){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),references:this.transformNode(e.references,t),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo,t),check:this.transformNode(e.check,t),generated:this.transformNode(e.generated,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e,t){return{kind:"AddColumnNode",column:this.transformNode(e.column,t)}}transformDropTable(e,t){return{kind:"DropTableNode",table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e,t){return{kind:"OrderByNode",items:this.transformNodeList(e.items,t)}}transformOrderByItem(e,t){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy,t),direction:this.transformNode(e.direction,t),collation:this.transformNode(e.collation,t),nulls:e.nulls}}transformGroupBy(e,t){return{kind:"GroupByNode",items:this.transformNodeList(e.items,t)}}transformGroupByItem(e,t){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy,t)}}transformUpdateQuery(e,t){return{kind:"UpdateQueryNode",table:this.transformNode(e.table,t),from:this.transformNode(e.from,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),updates:this.transformNodeList(e.updates,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),explain:this.transformNode(e.explain,t),limit:this.transformNode(e.limit,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t),orderBy:this.transformNode(e.orderBy,t)}}transformColumnUpdate(e,t){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column,t),value:this.transformNode(e.value,t)}}transformLimit(e,t){return{kind:"LimitNode",limit:this.transformNode(e.limit,t)}}transformOffset(e,t){return{kind:"OffsetNode",offset:this.transformNode(e.offset,t)}}transformOnConflict(e,t){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns,t),constraint:this.transformNode(e.constraint,t),indexExpression:this.transformNode(e.indexExpression,t),indexWhere:this.transformNode(e.indexWhere,t),updates:this.transformNodeList(e.updates,t),updateWhere:this.transformNode(e.updateWhere,t),doNothing:e.doNothing}}transformOnDuplicateKey(e,t){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates,t)}}transformCreateIndex(e,t){return{kind:"CreateIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists,where:this.transformNode(e.where,t),nullsNotDistinct:e.nullsNotDistinct}}transformList(e,t){return{kind:"ListNode",items:this.transformNodeList(e.items,t)}}transformDropIndex(e,t){return{kind:"DropIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e,t){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformUniqueConstraint(e,t){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),nullsNotDistinct:e.nullsNotDistinct,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformForeignKeyConstraint(e,t){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns,t),references:this.transformNode(e.references,t),name:this.transformNode(e.name,t),onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred}}transformSetOperation(e,t){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression,t),all:e.all}}transformReferences(e,t){return{kind:"ReferencesNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e,t){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression,t),name:this.transformNode(e.name,t)}}transformWith(e,t){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions,t),recursive:e.recursive}}transformCommonTableExpression(e,t){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name,t),materialized:e.materialized,expression:this.transformNode(e.expression,t)}}transformCommonTableExpressionName(e,t){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t)}}transformHaving(e,t){return{kind:"HavingNode",having:this.transformNode(e.having,t)}}transformCreateSchema(e,t){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema,t),ifNotExists:e.ifNotExists}}transformDropSchema(e,t){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema,t),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e,t){return{kind:"AlterTableNode",table:this.transformNode(e.table,t),renameTo:this.transformNode(e.renameTo,t),setSchema:this.transformNode(e.setSchema,t),columnAlterations:this.transformNodeList(e.columnAlterations,t),addConstraint:this.transformNode(e.addConstraint,t),dropConstraint:this.transformNode(e.dropConstraint,t),renameConstraint:this.transformNode(e.renameConstraint,t),addIndex:this.transformNode(e.addIndex,t),dropIndex:this.transformNode(e.dropIndex,t)}}transformDropColumn(e,t){return{kind:"DropColumnNode",column:this.transformNode(e.column,t)}}transformRenameColumn(e,t){return{kind:"RenameColumnNode",column:this.transformNode(e.column,t),renameTo:this.transformNode(e.renameTo,t)}}transformAlterColumn(e,t){return{kind:"AlterColumnNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),dataTypeExpression:this.transformNode(e.dataTypeExpression,t),setDefault:this.transformNode(e.setDefault,t),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e,t){return{kind:"ModifyColumnNode",column:this.transformNode(e.column,t)}}transformAddConstraint(e,t){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint,t)}}transformDropConstraint(e,t){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName,t),ifExists:e.ifExists,modifier:e.modifier}}transformRenameConstraint(e,t){return{kind:"RenameConstraintNode",oldName:this.transformNode(e.oldName,t),newName:this.transformNode(e.newName,t)}}transformCreateView(e,t){return{kind:"CreateViewNode",name:this.transformNode(e.name,t),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns,t),as:this.transformNode(e.as,t)}}transformRefreshMaterializedView(e,t){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(e.name,t),concurrently:e.concurrently,withNoData:e.withNoData}}transformDropView(e,t){return{kind:"DropViewNode",name:this.transformNode(e.name,t),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e,t){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression,t)}}transformDefaultValue(e,t){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue,t)}}transformOn(e,t){return{kind:"OnNode",on:this.transformNode(e.on,t)}}transformSelectModifier(e,t){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier,t),of:this.transformNodeList(e.of,t)}}transformCreateType(e,t){return{kind:"CreateTypeNode",name:this.transformNode(e.name,t),enum:this.transformNode(e.enum,t)}}transformDropType(e,t){return{kind:"DropTypeNode",name:this.transformNode(e.name,t),ifExists:e.ifExists}}transformExplain(e,t){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options,t)}}transformSchemableIdentifier(e,t){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema,t),identifier:this.transformNode(e.identifier,t)}}transformAggregateFunction(e,t){return{kind:"AggregateFunctionNode",func:e.func,aggregated:this.transformNodeList(e.aggregated,t),distinct:e.distinct,orderBy:this.transformNode(e.orderBy,t),withinGroup:this.transformNode(e.withinGroup,t),filter:this.transformNode(e.filter,t),over:this.transformNode(e.over,t)}}transformOver(e,t){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy,t),partitionBy:this.transformNode(e.partitionBy,t)}}transformPartitionBy(e,t){return{kind:"PartitionByNode",items:this.transformNodeList(e.items,t)}}transformPartitionByItem(e,t){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy,t)}}transformBinaryOperation(e,t){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand,t),operator:this.transformNode(e.operator,t),rightOperand:this.transformNode(e.rightOperand,t)}}transformUnaryOperation(e,t){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator,t),operand:this.transformNode(e.operand,t)}}transformUsing(e,t){return{kind:"UsingNode",tables:this.transformNodeList(e.tables,t)}}transformFunction(e,t){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments,t)}}transformCase(e,t){return{kind:"CaseNode",value:this.transformNode(e.value,t),when:this.transformNodeList(e.when,t),else:this.transformNode(e.else,t),isStatement:e.isStatement}}transformWhen(e,t){return{kind:"WhenNode",condition:this.transformNode(e.condition,t),result:this.transformNode(e.result,t)}}transformJSONReference(e,t){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference,t),traversal:this.transformNode(e.traversal,t)}}transformJSONPath(e,t){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator,t),pathLegs:this.transformNodeList(e.pathLegs,t)}}transformJSONPathLeg(e,t){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e,t){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator,t),values:this.transformNodeList(e.values,t)}}transformTuple(e,t){return{kind:"TupleNode",values:this.transformNodeList(e.values,t)}}transformMergeQuery(e,t){return{kind:"MergeQueryNode",into:this.transformNode(e.into,t),using:this.transformNode(e.using,t),whens:this.transformNodeList(e.whens,t),with:this.transformNode(e.with,t),top:this.transformNode(e.top,t),endModifiers:this.transformNodeList(e.endModifiers,t),output:this.transformNode(e.output,t),returning:this.transformNode(e.returning,t)}}transformMatched(e,t){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e,t){return{kind:"AddIndexNode",name:this.transformNode(e.name,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists}}transformCast(e,t){return{kind:"CastNode",expression:this.transformNode(e.expression,t),dataType:this.transformNode(e.dataType,t)}}transformFetch(e,t){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount,t),modifier:e.modifier}}transformTop(e,t){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e,t){return{kind:"OutputNode",selections:this.transformNodeList(e.selections,t)}}transformDataType(e,t){return e}transformSelectAll(e,t){return e}transformIdentifier(e,t){return e}transformValue(e,t){return e}transformPrimitiveValueList(e,t){return e}transformOperator(e,t){return e}transformDefaultInsertValue(e,t){return e}transformOrAction(e,t){return e}transformCollate(e,t){return e}}const jt=p({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),Pt={json_agg:!0,to_json:!0};class Jt extends Mt{#i;#s=new Set;#a=new Set;constructor(e){super(),this.#i=e}transformNodeImpl(e,t){if(!this.#d(e))return super.transformNodeImpl(e,t);const r=this.#u(e);for(const e of r)this.#a.add(e);const o=this.#h(e);for(const e of o)this.#s.add(e);const n=super.transformNodeImpl(e,t);for(const e of o)this.#s.delete(e);for(const e of r)this.#a.delete(e);return n}transformSchemableIdentifier(e,t){const r=super.transformSchemableIdentifier(e,t);return r.schema||!this.#s.has(e.identifier.name)?r:{...r,schema:w.create(this.#i)}}transformReferences(e,t){const r=super.transformReferences(e,t);return r.table.table.schema?r:{...r,table:b.createWithSchema(this.#i,r.table.table.identifier.name)}}transformAggregateFunction(e,t){return{...super.transformAggregateFunction({...e,aggregated:[]},t),aggregated:this.#c(e,t,"aggregated")}}transformFunction(e,t){return{...super.transformFunction({...e,arguments:[]},t),arguments:this.#c(e,t,"arguments")}}#c(e,t,r){return Pt[e.func]?e[r].map((e=>!b.is(e)||e.table.schema?this.transformNode(e,t):{...e,table:this.transformIdentifier(e.table.identifier,t)})):this.transformNodeList(e[r],t)}#d(e){return e.kind in jt}#h(e){const t=new Set;if("name"in e&&e.name&&g.is(e.name)&&this.#p(e.name,t),"from"in e&&e.from)for(const r of e.from.froms)this.#l(r,t);if("into"in e&&e.into&&this.#l(e.into,t),"table"in e&&e.table&&this.#l(e.table,t),"joins"in e&&e.joins)for(const r of e.joins)this.#l(r.table,t);return"using"in e&&e.using&&(v.is(e.using)?this.#l(e.using.table,t):this.#l(e.using,t)),t}#u(e){const t=new Set;return"with"in e&&e.with&&this.#f(e.with,t),t}#l(e,t){if(b.is(e))this.#p(e.table,t);else if(W.is(e)&&b.is(e.node))this.#p(e.node.table,t);else if(Me.is(e))for(const r of e.items)this.#l(r,t)}#p(e,t){const r=e.identifier.name;this.#s.has(r)||this.#a.has(r)||t.add(r)}#f(e,t){for(const r of e.expressions){const e=r.name.table.table.identifier.name;this.#a.has(e)||t.add(e)}}}class Qt{#m;constructor(e){this.#m=new Jt(e)}transformQuery(e){return this.#m.transformNode(e.node,e.queryId)}async transformResult(e){return e.result}}const $t=p({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>p({kind:"MatchedNode",not:e,bySource:t})});function Ut(e,t,r){return Ve.create(Ie([$t.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&r?xe(t[0],t[1],t[2]):qe(t)]:[]],"and",!1))}function Vt(e){return t(e)?_.create([e],[]):O(e)?e.toOperationNode():e}class zt{#N;#y;#w;constructor(){this.#N=new Promise(((e,t)=>{this.#w=t,this.#y=e}))}get promise(){return this.#N}resolve=e=>{this.#y&&this.#y(e)};reject=e=>{this.#w&&this.#w(e)}}async function Gt(e){const t=new zt,r=new zt;return e.provideConnection((async e=>(t.resolve(e),await r.promise))).catch((e=>t.reject(e))),p({connection:await t.promise,release:r.resolve})}const Kt=p([]);class Ht{#g;constructor(e=Kt){this.#g=e}get plugins(){return this.#g}transformQuery(e,t){for(const r of this.#g){const o=r.transformQuery({node:e,queryId:t});if(o.kind!==e.kind)throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "));e=o}return e}async executeQuery(e){return await this.provideConnection((async t=>{const r=await t.executeQuery(e);return"numUpdatedOrDeletedRows"in r&&ee("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#W(r,e.queryId)}))}async*stream(e,t){const{connection:r,release:o}=await Gt(this);try{for await(const o of r.streamQuery(e,t))yield await this.#W(o,e.queryId)}finally{o()}}async#W(e,t){for(const r of this.#g)e=await r.transformResult({result:e,queryId:t});return e}}class _t extends Ht{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new _t([...this.plugins,e])}withPlugins(e){return new _t([...this.plugins,...e])}withPluginAtFront(e){return new _t([e,...this.plugins])}withoutPlugins(){return new _t([])}}const Xt=new _t;class Yt{numChangedRows;constructor(e){this.numChangedRows=e}}class Zt{#t;constructor(e){this.#t=p(e)}modifyEnd(e){return new Zt({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new Zt({...this.#t,queryNode:Ke.cloneWithTop(this.#t.queryNode,Wt(e,t))})}using(...e){return new er({...this.#t,queryNode:ze.cloneWithUsing(this.#t.queryNode,nr("Using",e))})}returning(e){return new Zt({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,tt(e))})}returningAll(e){return new Zt({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,ot(e))})}output(e){return new Zt({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,tt(e))})}outputAll(e){return new Zt({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,ot(e))})}}class er{#t;constructor(e){this.#t=p(e)}modifyEnd(e){return new er({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new er({...this.#t,queryNode:Ke.cloneWithTop(this.#t.queryNode,Wt(e,t))})}whenMatched(){return this.#b([])}whenMatchedAnd(...e){return this.#b(e)}whenMatchedAndRef(e,t,r){return this.#b([e,t,r],!0)}#b(e,t){return new tr({...this.#t,queryNode:ze.cloneWithWhen(this.#t.queryNode,Ut({isMatched:!0},e,t))})}whenNotMatched(){return this.#O([])}whenNotMatchedAnd(...e){return this.#O(e)}whenNotMatchedAndRef(e,t,r){return this.#O([e,t,r],!0)}whenNotMatchedBySource(){return this.#O([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#O(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,r){return this.#O([e,t,r],!0,!0)}returning(e){return new er({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,tt(e))})}returningAll(e){return new er({...this.#t,queryNode:Ke.cloneWithReturning(this.#t.queryNode,ot(e))})}output(e){return new er({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,tt(e))})}outputAll(e){return new er({...this.#t,queryNode:Ke.cloneWithOutput(this.#t.queryNode,ot(e))})}#O(e,t=!1,r=!1){const o={...this.#t,queryNode:ze.cloneWithWhen(this.#t.queryNode,Ut({isMatched:!1,bySource:r},e,t))};return new(r?tr:rr)(o)}$call(e){return e(this)}$if(e,t){return e?t(this):new er({...this.#t})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e),{adapter:r}=this.#t.executor,o=e.query;return o.returning&&r.supportsReturning||o.output&&r.supportsOutput?t.rows:[new Yt(t.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=lt){const t=await this.executeTakeFirst();if(void 0===t){throw ft(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}}class tr{#t;constructor(e){this.#t=p(e)}thenDelete(){return new er({...this.#t,queryNode:ze.cloneWithThen(this.#t.queryNode,Vt("delete"))})}thenDoNothing(){return new er({...this.#t,queryNode:ze.cloneWithThen(this.#t.queryNode,Vt("do nothing"))})}thenUpdate(e){return new er({...this.#t,queryNode:ze.cloneWithThen(this.#t.queryNode,Vt(e(new It({queryId:this.#t.queryId,executor:Xt,queryNode:je.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate((t=>t.set(...e)))}}class rr{#t;constructor(e){this.#t=p(e)}thenDoNothing(){return new er({...this.#t,queryNode:ze.cloneWithThen(this.#t.queryNode,Vt("do nothing"))})}thenInsertValues(e){const[t,r]=at(e);return new er({...this.#t,queryNode:ze.cloneWithThen(this.#t.queryNode,Vt(De.cloneWith(De.createWithoutInto(),{columns:t,values:r})))})}}class or{#t;constructor(e){this.#t=p(e)}selectFrom(e){return yr({queryId:Ft(),executor:this.#t.executor,queryNode:He.createFrom(Hr(e),this.#t.withNode)})}selectNoFrom(e){return yr({queryId:Ft(),executor:this.#t.executor,queryNode:He.cloneWithSelections(He.create(this.#t.withNode),tt(e))})}insertInto(e){return new Ot({queryId:Ft(),executor:this.#t.executor,queryNode:De.create(Yr(e),this.#t.withNode)})}replaceInto(e){return new Ot({queryId:Ft(),executor:this.#t.executor,queryNode:De.create(Yr(e),this.#t.withNode,!0)})}deleteFrom(e){return new xt({queryId:Ft(),executor:this.#t.executor,queryNode:Je.create(Hr(e),this.#t.withNode)})}updateTable(e){return new It({queryId:Ft(),executor:this.#t.executor,queryNode:je.create(Hr(e),this.#t.withNode)})}mergeInto(e){return new Zt({queryId:Ft(),executor:this.#t.executor,queryNode:ze.create(Xr(e),this.#t.withNode)})}with(e,t){const r=Bt(e,t);return new or({...this.#t,withNode:this.#t.withNode?Rt.cloneWithExpression(this.#t.withNode,r):Rt.create(r)})}withRecursive(e,t){const r=Bt(e,t);return new or({...this.#t,withNode:this.#t.withNode?Rt.cloneWithExpression(this.#t.withNode,r):Rt.create(r,{recursive:!0})})}withPlugin(e){return new or({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new or({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new or({...this.#t,executor:this.#t.executor.withPluginAtFront(new Qt(e))})}}function nr(e,t){if(3===t.length)return function(e,t,r,o){return v.createWithOn(e,_r(t),xe(r,"=",o))}(e,t[0],t[1],t[2]);if(2===t.length)return function(e,t,r){return r(function(e,t){return new _e({joinNode:v.create(e,_r(t))})}(e,t)).toOperationNode()}(e,t[0],t[1]);if(1===t.length)return function(e,t){return v.create(e,_r(t))}(e,t[0]);throw new Error("not implemented")}const ir=p({is:e=>"OffsetNode"===e.kind,create:e=>p({kind:"OffsetNode",offset:e})}),sr=p({is:e=>"GroupByItemNode"===e.kind,create:e=>p({kind:"GroupByItemNode",groupBy:e})});function ar(e){return ue(e=d(e)?e(Qr()):e).map(sr.create)}const dr=p({is:e=>"SetOperationNode"===e.kind,create:(e,t,r)=>p({kind:"SetOperationNode",operator:e,expression:t,all:r})});function ur(e,t,r){return d(t)&&(t=t(Jr())),f(t)||(t=[t]),t.map((t=>dr.create(e,$r(t),r)))}class hr{#q;constructor(e){this.#q=e}get expressionType(){}as(e){return new cr(this,e)}or(...e){return new pr(I.create(this.#q,qe(e)))}and(...e){return new lr(C.create(this.#q,qe(e)))}$castTo(){return new hr(this.#q)}$notNull(){return new hr(this.#q)}toOperationNode(){return this.#q}}class cr{#k;#x;constructor(e,t){this.#k=e,this.#x=t}get expression(){return this.#k}get alias(){return this.#x}toOperationNode(){return W.create(this.#k.toOperationNode(),O(this.#x)?this.#x.toOperationNode():w.create(this.#x))}}class pr{#q;constructor(e){this.#q=e}get expressionType(){}as(e){return new cr(this,e)}or(...e){return new pr(I.create(this.#q,qe(e)))}$castTo(){return new pr(this.#q)}toOperationNode(){return Oe.create(this.#q)}}class lr{#q;constructor(e){this.#q=e}get expressionType(){}as(e){return new cr(this,e)}and(...e){return new lr(C.create(this.#q,qe(e)))}$castTo(){return new lr(this.#q)}toOperationNode(){return Oe.create(this.#q)}}const fr=p({is:e=>"FetchNode"===e.kind,create:(e,t)=>({kind:"FetchNode",rowCount:ye.create(e),modifier:t})});function mr(e,t){if(!r(e)&&!s(e))throw new Error(`Invalid fetch row count: ${e}`);if("only"!==(o=t)&&"with ties"!==o)throw new Error(`Invalid fetch modifier: ${t}`);var o;return fr.create(e,t)}class Nr{#t;constructor(e){this.#t=p(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new Nr({...this.#t,queryNode:Ke.cloneWithWhere(this.#t.queryNode,qe(e))})}whereRef(e,t,r){return new Nr({...this.#t,queryNode:Ke.cloneWithWhere(this.#t.queryNode,xe(e,t,r))})}having(...e){return new Nr({...this.#t,queryNode:He.cloneWithHaving(this.#t.queryNode,qe(e))})}havingRef(e,t,r){return new Nr({...this.#t,queryNode:He.cloneWithHaving(this.#t.queryNode,xe(e,t,r))})}select(e){return new Nr({...this.#t,queryNode:He.cloneWithSelections(this.#t.queryNode,tt(e))})}distinctOn(e){return new Nr({...this.#t,queryNode:He.cloneWithDistinctOn(this.#t.queryNode,ue(e))})}modifyFront(e){return new Nr({...this.#t,queryNode:He.cloneWithFrontModifier(this.#t.queryNode,x.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new Nr({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,x.createWithExpression(e.toOperationNode()))})}distinct(){return new Nr({...this.#t,queryNode:He.cloneWithFrontModifier(this.#t.queryNode,x.create("Distinct"))})}forUpdate(e){return new Nr({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,x.create("ForUpdate",e?l(e).map(Yr):void 0))})}forShare(e){return new Nr({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,x.create("ForShare",e?l(e).map(Yr):void 0))})}forKeyShare(e){return new Nr({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,x.create("ForKeyShare",e?l(e).map(Yr):void 0))})}forNoKeyUpdate(e){return new Nr({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,x.create("ForNoKeyUpdate",e?l(e).map(Yr):void 0))})}skipLocked(){return new Nr({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,x.create("SkipLocked"))})}noWait(){return new Nr({...this.#t,queryNode:Ke.cloneWithEndModifier(this.#t.queryNode,x.create("NoWait"))})}selectAll(e){return new Nr({...this.#t,queryNode:He.cloneWithSelections(this.#t.queryNode,ot(e))})}innerJoin(...e){return this.#r("InnerJoin",e)}leftJoin(...e){return this.#r("LeftJoin",e)}rightJoin(...e){return this.#r("RightJoin",e)}fullJoin(...e){return this.#r("FullJoin",e)}crossJoin(...e){return this.#r("CrossJoin",e)}innerJoinLateral(...e){return this.#r("LateralInnerJoin",e)}leftJoinLateral(...e){return this.#r("LateralLeftJoin",e)}crossJoinLateral(...e){return this.#r("LateralCrossJoin",e)}crossApply(...e){return this.#r("CrossApply",e)}outerApply(...e){return this.#r("OuterApply",e)}#r(e,t){return new Nr({...this.#t,queryNode:Ke.cloneWithJoin(this.#t.queryNode,nr(e,t))})}orderBy(...e){return new Nr({...this.#t,queryNode:Ke.cloneWithOrderByItems(this.#t.queryNode,re(e))})}groupBy(e){return new Nr({...this.#t,queryNode:He.cloneWithGroupByItems(this.#t.queryNode,ar(e))})}limit(e){return new Nr({...this.#t,queryNode:He.cloneWithLimit(this.#t.queryNode,kt.create(ge(e)))})}offset(e){return new Nr({...this.#t,queryNode:He.cloneWithOffset(this.#t.queryNode,ir.create(ge(e)))})}fetch(e,t="only"){return new Nr({...this.#t,queryNode:He.cloneWithFetch(this.#t.queryNode,mr(e,t))})}top(e,t){return new Nr({...this.#t,queryNode:Ke.cloneWithTop(this.#t.queryNode,Wt(e,t))})}union(e){return new Nr({...this.#t,queryNode:He.cloneWithSetOperations(this.#t.queryNode,ur("union",e,!1))})}unionAll(e){return new Nr({...this.#t,queryNode:He.cloneWithSetOperations(this.#t.queryNode,ur("union",e,!0))})}intersect(e){return new Nr({...this.#t,queryNode:He.cloneWithSetOperations(this.#t.queryNode,ur("intersect",e,!1))})}intersectAll(e){return new Nr({...this.#t,queryNode:He.cloneWithSetOperations(this.#t.queryNode,ur("intersect",e,!0))})}except(e){return new Nr({...this.#t,queryNode:He.cloneWithSetOperations(this.#t.queryNode,ur("except",e,!1))})}exceptAll(e){return new Nr({...this.#t,queryNode:He.cloneWithSetOperations(this.#t.queryNode,ur("except",e,!0))})}as(e){return new wr(this,e)}clearSelect(){return new Nr({...this.#t,queryNode:He.cloneWithoutSelections(this.#t.queryNode)})}clearWhere(){return new Nr({...this.#t,queryNode:Ke.cloneWithoutWhere(this.#t.queryNode)})}clearLimit(){return new Nr({...this.#t,queryNode:He.cloneWithoutLimit(this.#t.queryNode)})}clearOffset(){return new Nr({...this.#t,queryNode:He.cloneWithoutOffset(this.#t.queryNode)})}clearOrderBy(){return new Nr({...this.#t,queryNode:Ke.cloneWithoutOrderBy(this.#t.queryNode)})}clearGroupBy(){return new Nr({...this.#t,queryNode:He.cloneWithoutGroupBy(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Nr({...this.#t})}$castTo(){return new Nr(this.#t)}$narrowType(){return new Nr(this.#t)}$assertType(){return new Nr(this.#t)}$asTuple(){return new hr(this.toOperationNode())}$asScalar(){return new hr(this.toOperationNode())}withPlugin(e){return new Nr({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile();return(await this.#t.executor.executeQuery(e)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=lt){const t=await this.executeTakeFirst();if(void 0===t){throw ft(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e);for await(const e of r)yield*e.rows}async explain(e,t){const r=new Nr({...this.#t,queryNode:Ke.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}function yr(e){return new Nr(e)}class wr{#C;#x;constructor(e,t){this.#C=e,this.#x=t}get expression(){return this.#C}get alias(){return this.#x}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return W.create(this.#C.toOperationNode(),w.create(this.#x))}}const gr=p({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>p({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>p({...e,distinct:!0}),cloneWithOrderBy(e,t,r=!1){const o=r?"withinGroup":"orderBy";return p({...e,[o]:e[o]?Be.cloneWithItems(e[o],t):Be.create(t)})},cloneWithFilter:(e,t)=>p({...e,filter:e.filter?Qe.cloneWithOperation(e.filter,"And",t):Qe.create(t)}),cloneWithOrFilter:(e,t)=>p({...e,filter:e.filter?Qe.cloneWithOperation(e.filter,"Or",t):Qe.create(t)}),cloneWithOver:(e,t)=>p({...e,over:t})}),Wr=p({is:e=>"FunctionNode"===e.kind,create:(e,t)=>p({kind:"FunctionNode",func:e,arguments:t})});class br{#t;constructor(e){this.#t=p(e)}get expressionType(){}as(e){return new Or(this,e)}distinct(){return new br({...this.#t,aggregateFunctionNode:gr.cloneWithDistinct(this.#t.aggregateFunctionNode)})}orderBy(...e){return new br({...this.#t,aggregateFunctionNode:Ke.cloneWithOrderByItems(this.#t.aggregateFunctionNode,re(e))})}clearOrderBy(){return new br({...this.#t,aggregateFunctionNode:Ke.cloneWithoutOrderBy(this.#t.aggregateFunctionNode)})}withinGroupOrderBy(...e){return new br({...this.#t,aggregateFunctionNode:gr.cloneWithOrderBy(this.#t.aggregateFunctionNode,re(e),!0)})}filterWhere(...e){return new br({...this.#t,aggregateFunctionNode:gr.cloneWithFilter(this.#t.aggregateFunctionNode,qe(e))})}filterWhereRef(e,t,r){return new br({...this.#t,aggregateFunctionNode:gr.cloneWithFilter(this.#t.aggregateFunctionNode,xe(e,t,r))})}over(e){const t=new Ze({overNode:Re.create()});return new br({...this.#t,aggregateFunctionNode:gr.cloneWithOver(this.#t.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new br(this.#t)}$notNull(){return new br(this.#t)}toOperationNode(){return this.#t.aggregateFunctionNode}}class Or{#I;#x;constructor(e,t){this.#I=e,this.#x=t}get expression(){return this.#I}get alias(){return this.#x}toOperationNode(){return W.create(this.#I.toOperationNode(),w.create(this.#x))}}function qr(){const e=(e,t)=>new hr(Wr.create(e,ue(t??[]))),r=(e,t)=>new br({aggregateFunctionNode:gr.create(e,t?ue(t):void 0)});return Object.assign(e,{agg:r,avg:e=>r("avg",[e]),coalesce:(...t)=>e("coalesce",t),count:e=>r("count",[e]),countAll:e=>new br({aggregateFunctionNode:gr.create("count",ot(e))}),max:e=>r("max",[e]),min:e=>r("min",[e]),sum:e=>r("sum",[e]),any:t=>e("any",[t]),jsonAgg:e=>new br({aggregateFunctionNode:gr.create("json_agg",[t(e)?Yr(e):e.toOperationNode()])}),toJson:e=>new hr(Wr.create("to_json",[t(e)?Yr(e):e.toOperationNode()]))})}const kr=p({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>p({kind:"UnaryOperationNode",operator:e,operand:t})});const xr=p({is:e=>"CaseNode"===e.kind,create:e=>p({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>p({...e,when:p(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>p({...e,when:e.when?p([...e.when.slice(0,-1),Ve.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>p({...e,...t})});class Cr{#t;constructor(e){this.#t=p(e)}when(...e){return new Ir({...this.#t,node:xr.cloneWithWhen(this.#t.node,Ve.create(qe(e)))})}}class Ir{#t;constructor(e){this.#t=p(e)}then(e){return new Sr({...this.#t,node:xr.cloneWithThen(this.#t.node,We(e)?be(e):ge(e))})}}class Sr{#t;constructor(e){this.#t=p(e)}when(...e){return new Ir({...this.#t,node:xr.cloneWithWhen(this.#t.node,Ve.create(qe(e)))})}else(e){return new vr({...this.#t,node:xr.cloneWith(this.#t.node,{else:We(e)?be(e):ge(e)})})}end(){return new hr(xr.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new hr(xr.cloneWith(this.#t.node,{isStatement:!0}))}}class vr{#t;constructor(e){this.#t=p(e)}end(){return new hr(xr.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new hr(xr.cloneWith(this.#t.node,{isStatement:!0}))}}const Tr=p({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>p({kind:"JSONPathLegNode",type:e,value:t})});class Br{#q;constructor(e){this.#q=e}at(e){return this.#S("ArrayLocation",e)}key(e){return this.#S("Member",e)}#S(e,t){return ie.is(this.#q)?new Ar(ie.cloneWithTraversal(this.#q,ae.is(this.#q.traversal)?ae.cloneWithLeg(this.#q.traversal,Tr.create(e,t)):se.cloneWithValue(this.#q.traversal,ye.createImmediate(t)))):new Ar(ae.cloneWithLeg(this.#q,Tr.create(e,t)))}}class Ar extends Br{#q;constructor(e){super(e),this.#q=e}get expressionType(){}as(e){return new Rr(this,e)}$castTo(){return new Ar(this.#q)}$notNull(){return new Ar(this.#q)}toOperationNode(){return this.#q}}class Rr{#v;#x;constructor(e,t){this.#v=e,this.#x=t}get expression(){return this.#v}get alias(){return this.#x}toOperationNode(){return W.create(this.#v.toOperationNode(),O(this.#x)?this.#x.toOperationNode():w.create(this.#x))}}const Lr=p({is:e=>"TupleNode"===e.kind,create:e=>p({kind:"TupleNode",values:p(e)})}),Er=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],Fr=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],Dr=p({is:e=>"DataTypeNode"===e.kind,create:e=>p({kind:"DataTypeNode",dataType:e})});function Mr(e){return!!Er.includes(e)||!!Fr.some((t=>t.test(e)))}function jr(e){if(O(e))return e.toOperationNode();if(Mr(e))return Dr.create(e);throw new Error(`invalid column data type ${JSON.stringify(e)}`)}const Pr=p({is:e=>"CastNode"===e.kind,create:(e,t)=>p({kind:"CastNode",expression:e,dataType:t})});function Jr(t=Xt){function r(e,t){return new hr((r=e,o=t,kr.create(M.create(r),he(o))));var r,o}const o=Object.assign((function(e,t,r){return new hr(ke(e,t,r))}),{fn:void 0,eb:void 0,selectFrom:e=>yr({queryId:Ft(),executor:t,queryNode:He.createFrom(Hr(e))}),case:t=>new Cr({node:xr.create(e(t)?void 0:he(t))}),ref:(t,r)=>e(r)?new hr(ce(t)):new Br(function(e,t){const r=ce(e);if($(t))return ie.create(r,se.create(M.create(t)));const o=t.slice(0,-1);if($(o))return ie.create(r,ae.create(M.create(o)));throw new Error(`Invalid JSON operator: ${t}`)}(t,r)),jsonPath:()=>new Br(ae.create()),table:e=>new hr(Yr(e)),val:e=>new hr(ge(e)),refTuple:(...e)=>new hr(Lr.create(e.map(he))),tuple:(...e)=>new hr(Lr.create(e.map(ge))),lit:e=>new hr(be(e)),unary:r,not:e=>r("not",e),exists:e=>r("exists",e),neg:e=>r("-",e),between:(e,t,r)=>new hr(T.create(he(e),M.create("between"),C.create(ge(t),ge(r)))),betweenSymmetric:(e,t,r)=>new hr(T.create(he(e),M.create("between symmetric"),C.create(ge(t),ge(r)))),and:e=>f(e)?new hr(Ie(e,"and")):new hr(Ce(e,"and")),or:e=>f(e)?new hr(Ie(e,"or")):new hr(Ce(e,"or")),parens(...e){const t=qe(e);return Oe.is(t)?new hr(t):new hr(Oe.create(t))},cast:(e,t)=>new hr(Pr.create(he(e),jr(t))),withSchema:e=>Jr(t.withPluginAtFront(new Qt(e)))});return o.fn=qr(),o.eb=o,o}function Qr(e){return Jr()}function $r(e){if(O(e))return e.toOperationNode();if(d(e))return e(Qr()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(e)}`)}function Ur(e){if(O(e))return e.toOperationNode();if(d(e))return e(Qr()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function Vr(e){return q(e)||k(e)||d(e)}class zr{#T;get table(){return this.#T}constructor(e){this.#T=e}as(e){return new Gr(this.#T,e)}}class Gr{#T;#x;get table(){return this.#T}get alias(){return this.#x}constructor(e,t){this.#T=e,this.#x=t}toOperationNode(){return W.create(Yr(this.#T),w.create(this.#x))}}function Kr(e){return u(e)&&O(e)&&t(e.table)&&t(e.alias)}function Hr(e){return f(e)?e.map((e=>_r(e))):[_r(e)]}function _r(e){return t(e)?Xr(e):Kr(e)?e.toOperationNode():Ur(e)}function Xr(e){const t=" as ";if(e.includes(t)){const[r,o]=e.split(t).map(Zr);return W.create(Yr(r),w.create(o))}return Yr(e)}function Yr(e){if(e.includes(".")){const[t,r]=e.split(".").map(Zr);return b.createWithSchema(t,r)}return b.create(e)}function Zr(e){return e.trim()}class eo{#t;constructor(e){this.#t=p(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new ro(this,e)}$castTo(){return new eo({...this.#t})}$notNull(){return new eo(this.#t)}withPlugin(e){return new eo({...this.#t,plugins:void 0!==this.#t.plugins?p([...this.#t.plugins,e]):p([e])})}toOperationNode(){return this.#B(this.#A())}compile(e){return this.#R(this.#A(e))}async execute(e){const t=this.#A(e);return t.executeQuery(this.#R(t))}#A(e){const t=void 0!==e?e.getExecutor():Xt;return void 0!==this.#t.plugins?t.withPlugins(this.#t.plugins):t}#B(e){return e.transformQuery(this.#t.rawNode,this.#t.queryId)}#R(e){return e.compileQuery(this.#B(e),this.#t.queryId)}}function to(e){return new eo(e)}class ro{#L;#x;constructor(e,t){this.#L=e,this.#x=t}get expression(){return this.#L}get alias(){return this.#x}get rawBuilder(){return this.#L}toOperationNode(){return W.create(this.#L.toOperationNode(),O(this.#x)?this.#x.toOperationNode():w.create(this.#x))}}const oo=Object.assign(((e,...t)=>to({queryId:Ft(),rawNode:_.create(e,t?.map(no)??[])})),{ref:e=>to({queryId:Ft(),rawNode:_.createWithChild(ce(e))}),val:e=>to({queryId:Ft(),rawNode:_.createWithChild(ge(e))}),value(e){return this.val(e)},table:e=>to({queryId:Ft(),rawNode:_.createWithChild(Yr(e))}),id(...e){const t=new Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",to({queryId:Ft(),rawNode:_.create(t,e.map(w.create))})},lit:e=>to({queryId:Ft(),rawNode:_.createWithChild(ye.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>to({queryId:Ft(),rawNode:_.createWithSql(e)}),join(e,t=oo`, `){const r=new Array(Math.max(2*e.length-1,0)),o=t.toOperationNode();for(let t=0;t<e.length;++t)r[2*t]=no(e[t]),t!==e.length-1&&(r[2*t+1]=o);return to({queryId:Ft(),rawNode:_.createWithChildren(r)})}});function no(e){return O(e)?e.toOperationNode():ge(e)}export{T as $,Ve as A,t as B,U as C,G as D,o as E,M as F,r as G,s as H,w as I,n as J,i as K,He as L,c as M,oo as N,Mt as O,Oe as P,Ke as Q,_ as R,g as S,Et as T,zt as U,ye as V,Qt as W,a as X,h as Y,N as Z,me as _,V as a,ie as a$,Pr as a0,Dr as a1,Qr as a2,q as a3,k as a4,hr as a5,cr as a6,pr as a7,lr as a8,yr as a9,to as aA,_t as aB,Xt as aC,K as aD,Gr as aE,Kr as aF,gr as aG,W as aH,C as aI,X as aJ,dt as aK,St as aL,vt as aM,Mr as aN,st as aO,Je as aP,Ue as aQ,fr as aR,Le as aS,Wr as aT,sr as aU,Ee as aV,Fe as aW,v as aX,se as aY,Tr as aZ,ae as a_,Ot as aa,It as ab,xt as ac,lt as ad,ft as ae,_e as af,pt as ag,qt as ah,Ct as ai,Nt as aj,yt as ak,wt as al,br as am,Or as an,Ir as ao,Sr as ap,vr as aq,Br as ar,Ar as as,Rr as at,Zt as au,er as av,tr as aw,rr as ax,Yt as ay,Y as az,jr as b,kt as b0,Me as b1,$t as b2,ze as b3,ir as b4,mt as b5,ct as b6,S as b7,B as b8,A as b9,je as bA,Pe as bB,it as bC,Qe as bD,Rt as bE,R as ba,L as bb,E as bc,F as bd,D as be,j as bf,P as bg,J as bh,Q as bi,$ as bj,bt as bk,I as bl,H as bm,Be as bn,Ge as bo,Re as bp,Xe as bq,Ae as br,z as bs,$e as bt,x as bu,et as bv,b as bw,gt as bx,Lr as by,kr as bz,le as c,Yr as d,Ne as e,p as f,qe as g,$r as h,O as i,pe as j,Ft as k,zr as l,Ht as m,m as n,d as o,ce as p,u as q,or as r,Cr as s,xr as t,e as u,qr as v,ee as w,Gt as x,De as y,dr as z};
